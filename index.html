<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verano Surrealista – Publicación</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body { background: #000; color: #fff; font-family: 'Oswald', sans-serif; text-transform: uppercase; }
    .container { max-width: 400px; margin: 2rem auto; padding: 0 1rem; }
    h1 { text-align: center; margin-bottom: 1.5rem; }
    .camera-container {
      position: relative;
      width: 100%;
      /* 3:4 aspect ratio (height/width * 100%) = 133.33% */
      padding-top: 133.33%;
      background: #222;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .camera-container video,
    .camera-container img {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
    }
    button {
      background: #222f3f;
      color: #fff;
      border: none;
      padding: .75rem 1.5rem;
      cursor: pointer;
      margin: .5rem .25rem 0 .25rem;
      width: calc(50% - .5rem);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Publicación 3:4</h1>
    <div class="camera-container" id="camContainer">
      <video id="video" autoplay playsinline></video>
      <img id="overlay" src="assets/Marcopublicacion.png" alt="Marco Publicación">
    </div>
    <div style="text-align:center;">
      <button id="startBtn">Iniciar Cámara</button>
      <button id="captureBtn" disabled>Capturar y Descargar</button>
    </div>
  </div>

  <script>
    const startBtn   = document.getElementById('startBtn');
    const captureBtn = document.getElementById('captureBtn');
    const video      = document.getElementById('video');
    const overlay    = document.getElementById('overlay');

    let stream;

    startBtn.onclick = async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        video.srcObject = stream;
        startBtn.disabled = true;
        captureBtn.disabled = false;
      } catch (e) {
        alert('No se pudo acceder a la cámara.');
      }
    };

    captureBtn.onclick = () => {
      const w = video.videoWidth;
      const h = video.videoHeight;
      const canvas = document.createElement('canvas');
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');
      // Dibuja el video
      ctx.drawImage(video, 0, 0, w, h);
      // Dibuja el marco
      ctx.drawImage(overlay, 0, 0, w, h);
      // Descarga
      const link = document.createElement('a');
      link.download = 'foto-publicacion.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
      // Detener cámara
      stream.getTracks().forEach(t => t.stop());
      startBtn.disabled = false;
      captureBtn.disabled = true;
    };
  </script>
</body>
</html>
